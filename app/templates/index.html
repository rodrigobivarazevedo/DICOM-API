<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DICOM API Interface</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">DICOM API Interface</h1> 
        <div class="row">
            <div class="col-md-6 mb-3">
                <h3>Get All DICOM Metadata</h3>
                <button class="btn btn-primary" onclick="getAllMetadata()">Get all Metadata</button>
                <a href="/overview" class="btn btn-primary" target="_blank">View full dataset Images</a>
                <div class="mt-5" id="all-metadata"></div>
            </div>
            <div class="col-md-6">
                <h3>Get Metadata of a Specific Patient</h3>
                    <form onsubmit="return false;">
                        <div class="form-group">
                            <label for="patient-id-json">Patient ID:</label>
                            <input type="text" class="form-control" id="patient-id-json-input" placeholder="Enter Patient ID">
                        </div>
                        <button class="btn btn-primary" onclick="getPatientMetadata()">Get Metadata</button>
                    </form>
                <div class="mt-5" id="patient-metadata"></div>

                <div class="row mt-4">
                    <div class="col">
                        <h3>View DICOM Images for a Specific Patient</h3>
                        <form onsubmit="return false;">
                            <div class="form-group">
                                <label for="patient-id">Patient ID:</label>
                                <input type="text" class="form-control" id="patient-id-input" placeholder="Enter Patient ID">
                            </div>
                            <button class="btn btn-primary" onclick="getPatientImages()">Get Images</button>
                        </form>
                    </div>
                </div>
                <div class="mt-4" id="patient-images"></div>
            </div>

           
        </div>
        
        
        
    </div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- JavaScript to call API endpoints -->
    <script>
        async function getAllMetadata() {
        try {
            const response = await fetch('/api');
            const data = await response.json();
            displayAllMetadata(data);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function displayAllMetadata(metadata) {
        const metadataDiv = document.getElementById('all-metadata');
        metadataDiv.innerHTML = ''; // Clear existing content

        if (metadata.length === 0) {
            metadataDiv.innerHTML = '<p>No metadata found.</p>';
            return;
        }

        const table = document.createElement('table');
        table.classList.add('table', 'table-striped');

        // Create table header
        const tableHeader = document.createElement('thead');
        const headerRow = document.createElement('tr');
        const headers = Object.keys(metadata[0]); // Assuming all objects have the same keys
        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
        tableHeader.appendChild(headerRow);
        table.appendChild(tableHeader);

        // Create table body
        const tableBody = document.createElement('tbody');
        metadata.forEach(item => {
            const row = document.createElement('tr');
            headers.forEach(header => {
                const td = document.createElement('td');
                td.textContent = item[header];
                row.appendChild(td);
            });
            tableBody.appendChild(row);
        });
        table.appendChild(tableBody);

        metadataDiv.appendChild(table);
    }

    
        async function getPatientImages() {
            const patientId = document.getElementById('patient-id-input').value;
            try {
                const response = await fetch(`/patient/${patientId}`);
                const data = await response.text();
                const imagesDiv = document.getElementById('patient-images');
                imagesDiv.innerHTML = data;
            } catch (error) {
                console.error('Error:', error);
            }
        }



        async function getPatientMetadata() {
        const patientId = document.getElementById('patient-id-json-input').value;
        try {
            const response = await fetch(`/api/patient/${patientId}`);
            const data = await response.json();
            displayPatientMetadata(data);
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function displayPatientMetadata(metadata) {
        const metadataDiv = document.getElementById('patient-metadata');
        metadataDiv.innerHTML = ''; // Clear existing content

        if (metadata.length === 0) {
            metadataDiv.innerHTML = '<p>No metadata found for this patient.</p>';
            return;
        }

        const table = document.createElement('table');
        table.classList.add('table', 'table-striped');

        // Create table header
        const tableHeader = document.createElement('thead');
        const headerRow = document.createElement('tr');
        const headers = ['Patient ID', 'Age', 'Study Date'];
        headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
        });
        tableHeader.appendChild(headerRow);
        table.appendChild(tableHeader);

        // Create table body
        const tableBody = document.createElement('tbody');
        metadata.forEach(patient => {
            const row = document.createElement('tr');
            const cells = ['PatientID', 'Age', 'StudyDate'];
            cells.forEach(cellKey => {
                const td = document.createElement('td');
                td.textContent = patient[cellKey];
                row.appendChild(td);
            });
            tableBody.appendChild(row);
        });
        table.appendChild(tableBody);

        metadataDiv.appendChild(table);
    }


    </script>
</body>
</html>

